<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Noble Quran - Kinetic Timeline</title>
    <meta name="description" content="A kinetic timeline of the Quranic revelation summary with audio narration.">
    <meta name="theme-color" content="#050507">

    <!-- Favicon (SVG Data URI) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%23050507' stroke='%23D4AF37' stroke-width='2'/%3E%3Cpath d='M50 20 L60 40 L80 40 L65 55 L70 75 L50 60 L30 75 L35 55 L20 40 L40 40 Z' fill='%23D4AF37'/%3E%3C/svg%3E">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mipeal.github.io/al-quran/"> <!-- Update with your URL -->
    <meta property="og:title" content="The Noble Quran - Kinetic Timeline">
    <meta property="og:description" content="Explore the Quran summaries in chronological revelation order with poetic audio narration.">
    <meta property="og:image" content="quran-timeline-cover.png"> <!-- Host the downloaded poster here -->

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mipeal.github.io/al-quran/"> <!-- Update with your URL -->
    <meta property="twitter:title" content="The Noble Quran - Kinetic Timeline">
    <meta property="twitter:description" content="Explore the Quran summaries in chronological revelation order with poetic audio narration.">
    <meta property="twitter:image" content="quran-timeline-cover.png"> <!-- Host the downloaded poster here -->
    
    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Inter:wght@300;400;600&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>

    <style>
        :root {
            --bg-color: #050507;
            --text-main: #E2E8F0;
            --gold: #D4AF37;
            --gold-dim: #8A7018;
            --card-bg: rgba(20, 20, 25, 0.6);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .font-serif-display { font-family: 'Cinzel', serif; }
        .font-arabic { font-family: 'Amiri', serif; }

        /* Kinetic Effects */
        .kinetic-text {
            will-change: transform;
            transform-style: preserve-3d;
        }

        /* Noise Overlay */
        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            z-index: 50;
            opacity: 0.4;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 3px; }

        /* Loader */
        .loader {
            position: fixed;
            inset: 0;
            background: var(--bg-color);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.8s ease-out;
        }
        
        .card-glass {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Active Reading State */
        .card-active {
            border-color: #D4AF37 !important;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.2) !important;
            background: rgba(30, 30, 40, 0.8) !important;
            transform: scale(1.02);
        }

        /* Timeline Specifics */
        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, transparent, #D4AF37, transparent);
            transform: translateX(-50%);
            z-index: 0;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .timeline-node {
            position: absolute;
            left: 50%;
            top: 2rem;
            width: 16px;
            height: 16px;
            background: #050507;
            border: 2px solid #D4AF37;
            border-radius: 50%;
            transform: translateX(-50%);
            z-index: 10;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #D4AF37; }
        .toggle-checkbox:checked + .toggle-label { background-color: #D4AF37; }
        
        /* Controls */
        .control-glass {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        /* Audio Visualizer Bar (Simple CSS Animation) */
        .playing-indicator {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 12px;
        }
        .playing-bar {
            width: 3px;
            background: #D4AF37;
            animation: equalizer 1s infinite ease-in-out;
        }
        .playing-bar:nth-child(2) { animation-delay: 0.2s; height: 60%; }
        .playing-bar:nth-child(3) { animation-delay: 0.4s; height: 30%; }
        
        @keyframes equalizer {
            0%, 100% { height: 20%; }
            50% { height: 100%; }
        }

        /* Custom Select for Voice */
        .voice-select {
            background: rgba(0,0,0,0.5);
            color: #D4AF37;
            border: none;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            outline: none;
            max-width: 150px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .voice-select option {
            background: #050507;
            color: #D4AF37;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .timeline-line { left: 20px; }
            .timeline-node { left: 20px; }
        }
    </style>
</head>
<body class="opacity-0 transition-opacity duration-700 ease-out">

    <div class="noise-overlay"></div>

    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="text-gold text-4xl font-serif-display animate-pulse tracking-widest">IQRA</div>
        <div class="mt-4 text-xs text-gray-500 uppercase tracking-[0.3em]">Loading Divine Words...</div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full p-6 z-40 flex justify-between items-center bg-gradient-to-b from-black/90 to-transparent pointer-events-none">
        <span class="font-serif-display text-xl text-[#D4AF37] tracking-wider pointer-events-auto">The Noble Quran</span>
        <div class="pointer-events-auto flex gap-4 items-center">
            <!-- Voice Select UI -->
            <div class="flex items-center gap-2 mr-2">
                <label for="voiceSelect" class="text-[10px] text-gray-500 uppercase tracking-widest hidden md:block">Reader:</label>
                <select id="voiceSelect" class="voice-select control-glass" onchange="changeVoice(this.value)">
                    <option value="">Loading Voices...</option>
                </select>
            </div>
            
            <button onclick="generateOGImage()" class="hidden md:block text-xs border border-[#D4AF37] text-[#D4AF37] px-4 py-2 rounded-full hover:bg-[#D4AF37] hover:text-black transition-all duration-300">
                Download Poster
            </button>
        </div>
    </nav>

    <!-- Floating Controls -->
    <div class="fixed bottom-8 right-8 z-50 flex flex-col items-end gap-4">
        
        <!-- Narration Control -->
        <div class="flex items-center gap-3">
             <div id="now-playing" class="control-glass px-4 py-2 rounded-full text-[#D4AF37] text-xs font-bold uppercase tracking-wider opacity-0 transition-opacity duration-300 flex items-center gap-2">
                <div class="playing-indicator">
                    <div class="playing-bar"></div>
                    <div class="playing-bar"></div>
                    <div class="playing-bar"></div>
                </div>
                <span id="current-surah-name">Reading...</span>
            </div>

            <!-- Mute Button -->
            <button id="muteBtn" onclick="toggleMute()" class="control-glass w-10 h-10 rounded-full flex items-center justify-center text-[#D4AF37] hover:bg-white/10 transition-colors group" title="Toggle Sound">
                <svg id="soundIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/>
                    <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"/>
                    <path d="M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/>
                </svg>
                <svg id="muteIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16" class="hidden">
                    <path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"/>
                </svg>
            </button>

            <button id="playBtn" onclick="toggleNarration()" class="control-glass w-14 h-14 rounded-full flex items-center justify-center text-[#D4AF37] hover:scale-110 transition-transform group shadow-[0_0_20px_rgba(212,175,55,0.2)]" title="Start Auto-Scroll">
                <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" class="ml-1">
                    <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                </svg>
                <svg id="pauseIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" class="hidden">
                    <rect x="4" y="4" width="3" height="8" rx="1" />
                    <rect x="9" y="4" width="3" height="8" rx="1" />
                </svg>
            </button>
        </div>

        <!-- View Switcher -->
        <div class="control-glass p-1 rounded-full flex items-center relative">
            <div id="switchHighlight" class="absolute top-1 bottom-1 w-[50%] bg-[#D4AF37] rounded-full transition-all duration-300 left-1"></div>
            <button onclick="switchMode('revelation')" class="relative z-10 px-4 py-2 text-xs font-bold uppercase tracking-wider transition-colors duration-300 text-black" id="btn-revelation">
                Revelation
            </button>
            <button onclick="switchMode('mushaf')" class="relative z-10 px-4 py-2 text-xs font-bold uppercase tracking-wider transition-colors duration-300 text-[#D4AF37]" id="btn-mushaf">
                Mushaf
            </button>
        </div>
    </div>

    <!-- Hero Section -->
    <header class="relative h-screen w-full flex flex-col justify-center items-center text-center px-4 overflow-hidden">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-[#1a1a2e] via-[#050507] to-[#000000] -z-10"></div>
        
        <div id="hero-content" class="relative z-10">
            <p id="hero-subtitle" class="text-[#D4AF37] text-sm uppercase tracking-[0.4em] mb-6 kinetic-text">Chronological Order</p>
            <h1 id="hero-title" class="text-5xl md:text-9xl font-serif-display text-white mb-4 kinetic-text leading-tight mix-blend-overlay">
                REVELATION
            </h1>
            <p id="hero-desc" class="text-gray-400 max-w-md mx-auto font-light leading-relaxed kinetic-text">
                A journey through the timeline of divine command.
            </p>
        </div>

        <div class="absolute bottom-10 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 opacity-60">
            <span class="text-[10px] uppercase tracking-widest">Tap Play to Start</span>
            <div class="w-[1px] h-12 bg-gradient-to-b from-[#D4AF37] to-transparent animate-bounce"></div>
        </div>
    </header>

    <!-- Main Timeline Content -->
    <main class="relative z-10 max-w-6xl mx-auto px-4 pb-32">
        <div class="relative">
            <div class="timeline-line h-full"></div>
            <div id="surah-timeline" class="flex flex-col gap-12 py-20">
                <!-- JS Injected Content -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="relative py-20 border-t border-white/5 text-center z-20 bg-[#050507]">
        <h2 class="font-serif-display text-3xl md:text-5xl text-[#D4AF37] mb-6">Sadaqallahul Azim</h2>
        <p class="text-gray-600 text-sm" id="footer-text">Generated aesthetic experience</p>
    </footer>

    <canvas id="ogCanvas" width="1200" height="630" class="hidden"></canvas>

    <script>
        // --- DATA ---
        const revelationOrder = [
            96, 68, 73, 74, 1, 111, 81, 87, 92, 89, 93, 94, 103, 100, 108, 102, 107, 109, 105, 113, 
            114, 112, 53, 80, 97, 91, 85, 95, 106, 101, 75, 104, 77, 50, 90, 86, 54, 38, 7, 72, 
            36, 25, 35, 19, 20, 56, 26, 27, 28, 17, 10, 11, 12, 15, 6, 37, 31, 34, 39, 40, 
            41, 42, 43, 44, 45, 46, 51, 88, 18, 16, 71, 14, 21, 23, 32, 52, 67, 69, 70, 78, 
            79, 82, 84, 30, 29, 83, 2, 8, 3, 33, 60, 4, 99, 57, 47, 13, 55, 76, 65, 98, 
            59, 110, 24, 22, 63, 58, 49, 66, 64, 61, 62, 48, 5, 9
        ];

        const surahsDB = [
            { no: 1, name: "Al-Fatiha", meaning: "The Opening", summary: "The essence of the Quran; a prayer for guidance, mercy, and lordship." },
            { no: 2, name: "Al-Baqarah", meaning: "The Cow", summary: "Comprehensive laws, stories of prophets, and guidance for the believers." },
            { no: 3, name: "Ali 'Imran", meaning: "Family of Imran", summary: "On the oneness of God, the story of Mary and Jesus, and steadfastness." },
            { no: 4, name: "An-Nisa", meaning: "The Women", summary: "Laws regarding family, women's rights, orphans, and social justice." },
            { no: 5, name: "Al-Ma'idah", meaning: "The Table Spread", summary: "Dietary laws, fulfillment of oaths, and the perfection of religion." },
            { no: 6, name: "Al-An'am", meaning: "The Cattle", summary: "Emphasizes monotheism, resurrection, and refutes polytheism." },
            { no: 7, name: "Al-A'raf", meaning: "The Heights", summary: "Stories of past prophets and the consequences of rejecting truth." },
            { no: 8, name: "Al-Anfal", meaning: "The Spoils of War", summary: "Laws of war, peace, and reliance on God during conflict." },
            { no: 9, name: "At-Tawbah", meaning: "The Repentance", summary: "Disassociation from idolaters and the importance of sincere repentance." },
            { no: 10, name: "Yunus", meaning: "Jonah", summary: "God's signs in creation and the stories of Noah, Moses, and Jonah." },
            { no: 11, name: "Hud", meaning: "Hud", summary: "Detailed accounts of prophets Hud, Salih, Shu'aib and the need for patience." },
            { no: 12, name: "Yusuf", meaning: "Joseph", summary: "The beautiful narrative of Prophet Joseph, teaching patience and trust in God's plan." },
            { no: 13, name: "Ar-Ra'd", meaning: "The Thunder", summary: "The truth of the Quran and God's power manifest in nature." },
            { no: 14, name: "Ibrahim", meaning: "Abraham", summary: "Abraham's prayer for Makkah and the message of gratitude vs ingratitude." },
            { no: 15, name: "Al-Hijr", meaning: "The Rocky Tract", summary: "Protection of the Quran and the story of creation and Iblis (Satan)." },
            { no: 16, name: "An-Nahl", meaning: "The Bee", summary: "Enumerates God's blessings and commands justice and good conduct." },
            { no: 17, name: "Al-Isra", meaning: "The Night Journey", summary: "The Prophet's night journey, moral commandments, and the Quran's nature." },
            { no: 18, name: "Al-Kahf", meaning: "The Cave", summary: "Four stories (The Cave, The Garden, Moses, Dhul-Qarnayn) teaching faith against trials." },
            { no: 19, name: "Maryam", meaning: "Mary", summary: "The stories of Zachariah, John, Mary, and Jesus, emphasizing God's mercy." },
            { no: 20, name: "Ta-Ha", meaning: "Ta-Ha", summary: "Reassurance to the Prophet and the detailed story of Moses and Pharaoh." },
            { no: 21, name: "Al-Anbiya", meaning: "The Prophets", summary: "The unity of the message of all past prophets and the inevitability of Judgment." },
            { no: 22, name: "Al-Hajj", meaning: "The Pilgrimage", summary: "Regulations of Hajj, the power of God, and permission to defend against oppression." },
            { no: 23, name: "Al-Mu'minun", meaning: "The Believers", summary: "Characteristics of successful believers and the stages of human creation." },
            { no: 24, name: "An-Nur", meaning: "The Light", summary: "Laws regarding modesty, adultery, and the famous 'Verse of Light'." },
            { no: 25, name: "Al-Furqan", meaning: "The Criterion", summary: "The Quran as the criterion between right and wrong; attributes of the servants of the Most Merciful." },
            { no: 26, name: "Ash-Shu'ara", meaning: "The Poets", summary: "Stories of many prophets and the rejection they faced from their people." },
            { no: 27, name: "An-Naml", meaning: "The Ant", summary: "The story of Solomon, the Queen of Sheba, and the knowledge of the Unseen." },
            { no: 28, name: "Al-Qasas", meaning: "The Narratives", summary: "Detailed life of Moses before prophethood and the arrogance of Qarun." },
            { no: 29, name: "Al-Ankabut", meaning: "The Spider", summary: "The trial of faith and the flimsiness of relying on other than God." },
            { no: 30, name: "Ar-Rum", meaning: "The Romans", summary: "Prophecy of Roman victory and signs of God in creation and marriage." },
            { no: 31, name: "Luqman", meaning: "Luqman", summary: "The wisdom of Luqman to his son regarding monotheism and moderation." },
            { no: 32, name: "As-Sajdah", meaning: "The Prostration", summary: "The creation of man, the revelation of the Book, and the Day of Judgment." },
            { no: 33, name: "Al-Ahzab", meaning: "The Combined Forces", summary: "Social etiquette, the Battle of the Trench, and the status of the Prophet's wives." },
            { no: 34, name: "Saba", meaning: "Sheba", summary: "The gratitude of David and Solomon versus the ingratitude of the people of Sheba." },
            { no: 35, name: "Fatir", meaning: "The Originator", summary: "God's power to create angels and the promise of the Hereafter." },
            { no: 36, name: "Ya-Sin", meaning: "Ya-Sin", summary: "The 'Heart of the Quran'; affirms revelation, resurrection, and God's sovereignty." },
            { no: 37, name: "As-Saffat", meaning: "Those Who Set Ranks", summary: "The unity of God, angels, and the story of Abraham's sacrifice." },
            { no: 38, name: "Sad", meaning: "The Letter Sad", summary: "The patience of David, Solomon, and Job; the debate between God and Iblis." },
            { no: 39, name: "Az-Zumar", meaning: "The Groups", summary: "Sincerity in religion and the scene of people being led to Paradise or Hell." },
            { no: 40, name: "Ghafir", meaning: "The Forgiver", summary: "God's forgiveness, the believer in Pharaoh's court, and call to pray." },
            { no: 41, name: "Fussilat", meaning: "Explained in Detail", summary: "The Quran described; the testimony of one's own skin on Judgment Day." },
            { no: 42, name: "Ash-Shura", meaning: "The Consultation", summary: "The importance of consultation (Shura) and the unity of revealed religion." },
            { no: 43, name: "Az-Zukhruf", meaning: "The Ornaments of Gold", summary: "Material wealth is not a sign of God's love; the error of attributing children to God." },
            { no: 44, name: "Ad-Dukhan", meaning: "The Smoke", summary: "Warning of the coming smoke and the night of decree (Laylat al-Qadr)." },
            { no: 45, name: "Al-Jathiyah", meaning: "The Crouching", summary: "The humility of all nations on Judgment Day and signs in the universe." },
            { no: 46, name: "Al-Ahqaf", meaning: "The Wind-Curved Sandhills", summary: "Warning to the disbelievers about the fate of the people of 'Ad." },
            { no: 47, name: "Muhammad", meaning: "Muhammad", summary: "The condition of believers vs disbelievers and the command to be firm." },
            { no: 48, name: "Al-Fath", meaning: "The Victory", summary: "The Treaty of Hudaybiyyah declared as a manifest victory." },
            { no: 49, name: "Al-Hujurat", meaning: "The Rooms", summary: "Etiquette, brotherhood, and avoiding suspicion, spying, and backbiting." },
            { no: 50, name: "Qaf", meaning: "The Letter Qaf", summary: "Arguments for the resurrection and the recording angels." },
            { no: 51, name: "Adh-Dhariyat", meaning: "The Winnowing Winds", summary: "The purpose of creating Jinn and Mankind is solely for worship." },
            { no: 52, name: "At-Tur", meaning: "The Mount", summary: "Oaths by the Mount and the inevitable punishment for deniers." },
            { no: 53, name: "An-Najm", meaning: "The Star", summary: "The Prophet's ascension (Mi'raj) and refutation of idol worship." },
            { no: 54, name: "Al-Qamar", meaning: "The Moon", summary: "The splitting of the moon and the repetition of 'Is there any that will receive admonition?'" },
            { no: 55, name: "Ar-Rahman", meaning: "The Beneficent", summary: "Enumerates God's bounties with the refrain 'Which of the favors of your Lord will you deny?'" },
            { no: 56, name: "Al-Waqi'ah", meaning: "The Inevitable", summary: "The three classes of people on Judgment Day and their respective fates." },
            { no: 57, name: "Al-Hadid", meaning: "The Iron", summary: "The reality of the transient life, spending in charity, and the strength of iron." },
            { no: 58, name: "Al-Mujadila", meaning: "The Pleading Woman", summary: "God hears every whisper; laws regarding marital disputes and secret counsels." },
            { no: 59, name: "Al-Hashr", meaning: "The Exile", summary: "The banishment of treacherous tribes and the beautiful names of God." },
            { no: 60, name: "Al-Mumtahanah", meaning: "She That Is to Be Examined", summary: "Relations with non-Muslims; love and hate for the sake of God." },
            { no: 61, name: "As-Saff", meaning: "The Ranks", summary: "Unity in striving for God's cause and the prophecy of Ahmad (Jesus about Muhammad)." },
            { no: 62, name: "Al-Jumu'ah", meaning: "The Congregation", summary: "The importance of the Friday prayer and leaving trade for remembrance." },
            { no: 63, name: "Al-Munafiqun", meaning: "The Hypocrites", summary: "Exposing the internal enemy and the danger of hypocrisy." },
            { no: 64, name: "At-Taghabun", meaning: "The Mutual Disillusion", summary: "The Day of gathering where gains and losses become apparent." },
            { no: 65, name: "At-Talaq", meaning: "The Divorce", summary: "Laws of divorce, waiting periods, and trust in God for provision." },
            { no: 66, name: "At-Tahrim", meaning: "The Prohibition", summary: "Protecting oneself and family from Fire; examples of wives of prophets." },
            { no: 67, name: "Al-Mulk", meaning: "The Sovereignty", summary: "God's dominion over life and death to test who is best in deeds." },
            { no: 68, name: "Al-Qalam", meaning: "The Pen", summary: "Defense of the Prophet's sanity and character; the story of the owners of the garden." },
            { no: 69, name: "Al-Haqqah", meaning: "The Reality", summary: "The inevitable reality of Judgment and the truth of the Quran." },
            { no: 70, name: "Al-Ma'arij", meaning: "The Ascending Stairways", summary: "The patience required for the long Day of Judgment." },
            { no: 71, name: "Nuh", meaning: "Noah", summary: "Noah's tireless preaching to his people and their stubborn rejection." },
            { no: 72, name: "Al-Jinn", meaning: "The Jinn", summary: "A group of Jinn listen to the Quran and believe; guidance is for all beings." },
            { no: 73, name: "Al-Muzzammil", meaning: "The Enshrouded One", summary: "Command to pray at night (Qiyam) and recite Quran with measured tone." },
            { no: 74, name: "Al-Muddaththir", meaning: "The Cloaked One", summary: "The command to arise and warn; description of Hellfire (Saqar)." },
            { no: 75, name: "Al-Qiyamah", meaning: "The Resurrection", summary: "The certainty of resurrection and the pangs of death." },
            { no: 76, name: "Al-Insan", meaning: "The Man", summary: "The creation of man and the rewards of Paradise for the righteous." },
            { no: 77, name: "Al-Mursalat", meaning: "The Emissaries", summary: "Oaths by winds and angels; 'Woe that Day to the deniers'." },
            { no: 78, name: "An-Naba", meaning: "The Tidings", summary: "The great news of the Resurrection and the earth as a resting place." },
            { no: 79, name: "An-Nazi'at", meaning: "Those Who Drag Forth", summary: "The soul's extraction at death and the story of Moses calling Pharaoh." },
            { no: 80, name: "Abasa", meaning: "He Frowned", summary: "The Prophet corrected for frowning at a blind man; the value of the sincere seeker." },
            { no: 81, name: "At-Takwir", meaning: "The Overthrowing", summary: "Graphic description of the end of the world when the sun is wrapped up." },
            { no: 82, name: "Al-Infitar", meaning: "The Cleaving", summary: "The sky breaking apart and guardians recording deeds." },
            { no: 83, name: "Al-Mutaffifin", meaning: "The Defrauding", summary: "Warning to those who cheat in weights and measures." },
            { no: 84, name: "Al-Inshiqaq", meaning: "The Sundering", summary: "The earth flattening and the book of deeds given in right or left hand." },
            { no: 85, name: "Al-Buruj", meaning: "The Mansions of the Stars", summary: "The story of the trench makers who burned believers alive." },
            { no: 86, name: "At-Tariq", meaning: "The Nightcommer", summary: "The creation of man from fluid and the watcher over every soul." },
            { no: 87, name: "Al-A'la", meaning: "The Most High", summary: "God knows the manifest and hidden; success for those who purify themselves." },
            { no: 88, name: "Al-Ghashiyah", meaning: "The Overwhelming", summary: "Faces downcast or joyful on Judgment Day." },
            { no: 89, name: "Al-Fajr", meaning: "The Dawn", summary: "The fate of past nations and the soul at peace returning to its Lord." },
            { no: 90, name: "Al-Balad", meaning: "The City", summary: "Man created in toil; the steep path of freeing slaves and feeding the poor." },
            { no: 91, name: "Ash-Shams", meaning: "The Sun", summary: "Success is for he who purifies the soul, failure for he who corrupts it." },
            { no: 92, name: "Al-Layl", meaning: "The Night", summary: "Striving is diverse; the one who gives and fears God vs the miser." },
            { no: 93, name: "Ad-Duha", meaning: "The Morning Hours", summary: "Reassurance that God has not forsaken the Prophet; command to help orphans." },
            { no: 94, name: "Ash-Sharh", meaning: "The Relief", summary: "Ease comes with hardship; elevating the Prophet's mention." },
            { no: 95, name: "At-Tin", meaning: "The Fig", summary: "Man created in the best stature, then reduced to the lowest, except believers." },
            { no: 96, name: "Al-Alaq", meaning: "The Clot", summary: "The first revelation: 'Read in the name of your Lord'." },
            { no: 97, name: "Al-Qadr", meaning: "The Power", summary: "The Night of Decree is better than a thousand months." },
            { no: 98, name: "Al-Bayyinah", meaning: "The Clear Proof", summary: "Those who believe and do good are the best of creatures." },
            { no: 99, name: "Az-Zalzalah", meaning: "The Earthquake", summary: "The earth throwing up its burdens; seeing an atom's weight of good or evil." },
            { no: 100, name: "Al-Adiyat", meaning: "The Courser", summary: "The ungrateful nature of man and his love for wealth." },
            { no: 101, name: "Al-Qari'ah", meaning: "The Calamity", summary: "The scales of deeds; a life of pleasure vs the abyss." },
            { no: 102, name: "At-Takathur", meaning: "The Rivalry in World Increase", summary: "Distraction by worldly gain until visiting the graves." },
            { no: 103, name: "Al-Asr", meaning: "The Declining Day", summary: "Mankind is in loss, except those with faith, good deeds, and patience." },
            { no: 104, name: "Al-Humazah", meaning: "The Traducer", summary: "Woe to every slanderer and backbiter who gathers wealth." },
            { no: 105, name: "Al-Fil", meaning: "The Elephant", summary: "God's protection of the Kaaba from the army of the elephant." },
            { no: 106, name: "Quraysh", meaning: "Quraysh", summary: "Command to the Quraysh to worship the Lord of the House for their security." },
            { no: 107, name: "Al-Ma'un", meaning: "The Small Kindnesses", summary: "Condemnation of those who deny the reckoning and refuse small kindnesses." },
            { no: 108, name: "Al-Kawthar", meaning: "The Abundance", summary: "The gift of Al-Kawthar to the Prophet; his enemy is the one cut off." },
            { no: 109, name: "Al-Kafirun", meaning: "The Disbelievers", summary: "Complete disassociation from the worship of false gods." },
            { no: 110, name: "An-Nasr", meaning: "The Divine Support", summary: "The arrival of victory and crowds entering God's religion." },
            { no: 111, name: "Al-Masad", meaning: "The Palm Fiber", summary: "The doom of Abu Lahab and his wife." },
            { no: 112, name: "Al-Ikhlas", meaning: "The Sincerity", summary: "The pure definition of Monotheism: God is One, Eternal, Unbegotten." },
            { no: 113, name: "Al-Falaq", meaning: "The Daybreak", summary: "Seeking refuge in God from the evil of created things and envy." },
            { no: 114, name: "An-Nas", meaning: "The Mankind", summary: "Seeking refuge in the Lord of people from the whispers of Satan." }
        ];

        // --- STATE & LOGIC ---
        let currentMode = 'revelation';
        let lenis;
        let narrator = {
            isPlaying: false,
            isMuted: false,
            currentIndex: 0,
            utterance: null,
            voice: null,
            timer: null
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            initLenis();
            renderTimeline(currentMode);
            initVoiceSystem();

            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                document.getElementById('loader').style.pointerEvents = 'none';
                document.body.classList.remove('opacity-0');
            }, 1500);
        });

        function initLenis() {
            lenis = new Lenis({
                duration: 1.2,
                easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
                smooth: true
            });
            
            function raf(time) {
                lenis.raf(time);
                requestAnimationFrame(raf);
            }
            requestAnimationFrame(raf);
        }

        // --- VOICE SYSTEM ---
        function initVoiceSystem() {
            const loadVoices = () => {
                const voices = window.speechSynthesis.getVoices();
                const voiceSelect = document.getElementById('voiceSelect');
                
                if (voices.length > 0) {
                    voiceSelect.innerHTML = '';
                    const englishVoices = voices.filter(v => v.lang.startsWith('en'));
                    englishVoices.sort((a, b) => {
                        const isNaturalA = a.name.includes('Natural') || a.name.includes('Enhanced') || a.name.includes('Premium');
                        const isNaturalB = b.name.includes('Natural') || b.name.includes('Enhanced') || b.name.includes('Premium');
                        return isNaturalB - isNaturalA;
                    });

                    englishVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name.replace('Microsoft', '').replace('Google', '').replace('Online (Natural) - English (United States)', 'Natural US').substring(0, 30)}...`;
                        voiceSelect.appendChild(option);
                    });

                    const bestVoice = englishVoices.find(v => v.name.includes('Natural') || v.name.includes('Enhanced')) 
                        || englishVoices.find(v => v.name.includes('Google US English'))
                        || englishVoices.find(v => v.name.includes('Samantha'))
                        || englishVoices[0];

                    if (bestVoice) {
                        narrator.voice = bestVoice;
                        voiceSelect.value = bestVoice.name;
                    }
                } else {
                    voiceSelect.innerHTML = '<option>No Voices Found</option>';
                }
            };

            loadVoices();
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }

        function changeVoice(voiceName) {
            const voices = window.speechSynthesis.getVoices();
            const selected = voices.find(v => v.name === voiceName);
            if(selected) {
                narrator.voice = selected;
                if(narrator.isPlaying && !narrator.isMuted) {
                    window.speechSynthesis.cancel();
                    speakNextCard();
                }
            }
        }

        function toggleMute() {
            narrator.isMuted = !narrator.isMuted;
            const soundIcon = document.getElementById('soundIcon');
            const muteIcon = document.getElementById('muteIcon');
            const indicator = document.getElementById('now-playing');

            // Update UI
            if (narrator.isMuted) {
                soundIcon.classList.add('hidden');
                muteIcon.classList.remove('hidden');
                document.querySelector('.playing-indicator').style.opacity = '0.2';
            } else {
                soundIcon.classList.remove('hidden');
                muteIcon.classList.add('hidden');
                document.querySelector('.playing-indicator').style.opacity = '1';
            }

            // Logic Handling
            if (narrator.isPlaying) {
                // Temporarily stop to switch modes smoothly
                narrator.isPlaying = false;
                window.speechSynthesis.cancel();
                clearTimeout(narrator.timer);
                
                // Restart logic with new mute state
                narrator.isPlaying = true;
                speakNextCard();
            }
        }

        function toggleNarration() {
            const btn = document.getElementById('playBtn');
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            const indicator = document.getElementById('now-playing');

            if (narrator.isPlaying) {
                // STOP
                narrator.isPlaying = false;
                window.speechSynthesis.cancel();
                clearTimeout(narrator.timer);
                
                btn.classList.remove('bg-[#D4AF37]', 'text-black');
                btn.classList.add('text-[#D4AF37]');
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                indicator.style.opacity = '0';
                
                document.querySelectorAll('.surah-card > div').forEach(el => el.classList.remove('card-active'));

            } else {
                // START
                narrator.isPlaying = true;
                
                btn.classList.add('bg-[#D4AF37]', 'text-black');
                btn.classList.remove('text-[#D4AF37]');
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                indicator.style.opacity = '1';

                speakNextCard();
            }
        }

        function speakNextCard() {
            if (!narrator.isPlaying) return;

            const cards = document.querySelectorAll('.surah-card');
            if (narrator.currentIndex >= cards.length) {
                narrator.currentIndex = 0; 
            }

            const wrapper = cards[narrator.currentIndex];
            const cardInner = wrapper.querySelector('.card-glass');
            
            // Highlight & Scroll
            document.querySelectorAll('.surah-card > div').forEach(el => el.classList.remove('card-active'));
            cardInner.classList.add('card-active');
            
            const rect = wrapper.getBoundingClientRect();
            lenis.scrollTo(wrapper, { offset: -window.innerHeight/2 + rect.height/2, duration: 1.5 });

            // Data Setup
            let currentSurah;
            if (currentMode === 'revelation') {
                const revNum = revelationOrder[narrator.currentIndex];
                currentSurah = surahsDB.find(s => s.no === revNum);
            } else {
                currentSurah = surahsDB[narrator.currentIndex]; 
            }

            const statusText = narrator.isMuted ? 'Auto-Scrolling...' : 'Reading...';
            document.getElementById('current-surah-name').textContent = `${statusText} ${currentSurah.name}`;
            
            // --- BRANCHING LOGIC ---
            if (narrator.isMuted) {
                // SILENT MODE: Calculate duration based on text length
                // Approx 200 words per minute = ~3 words per second = ~300ms per word
                // Add base 4 seconds for absorbing the visual
                const text = `${currentSurah.name} ${currentSurah.meaning} ${currentSurah.summary}`;
                const wordCount = text.split(' ').length;
                const duration = Math.max(4000, (wordCount * 300) + 2000); 

                narrator.timer = setTimeout(() => {
                    if (narrator.isPlaying) {
                        narrator.currentIndex++;
                        speakNextCard();
                    }
                }, duration);

            } else {
                // VOICE MODE
                const textToRead = `${currentSurah.name}. ${currentSurah.meaning}. ... ${currentSurah.summary}`;
                const utterance = new SpeechSynthesisUtterance(textToRead);
                utterance.voice = narrator.voice;
                utterance.rate = 0.9; 
                utterance.pitch = 1.0;
                utterance.volume = 1.0;

                utterance.onend = () => {
                    if (narrator.isPlaying) {
                        narrator.currentIndex++;
                        setTimeout(speakNextCard, 800);
                    }
                };
                
                // Safety timeout in case speech engine stalls
                // utterance.onerror = () => ... (optional robustness)

                window.speechSynthesis.speak(utterance);
            }
        }

        function switchMode(mode) {
            if (currentMode === mode) return;
            
            if(narrator.isPlaying) toggleNarration();
            narrator.currentIndex = 0;

            currentMode = mode;

            const hl = document.getElementById('switchHighlight');
            const btnRev = document.getElementById('btn-revelation');
            const btnMus = document.getElementById('btn-mushaf');
            const heroSub = document.getElementById('hero-subtitle');
            const heroTitle = document.getElementById('hero-title');
            const heroDesc = document.getElementById('hero-desc');

            if (mode === 'mushaf') {
                hl.style.left = '50%';
                btnRev.classList.replace('text-black', 'text-[#D4AF37]');
                btnMus.classList.replace('text-[#D4AF37]', 'text-black');
                
                heroSub.textContent = "Traditional Order";
                heroTitle.textContent = "AL-QURAN";
                heroDesc.textContent = "The compiled order of the Mushaf, from Al-Fatiha to An-Nas.";
            } else {
                hl.style.left = '1px';
                btnRev.classList.replace('text-[#D4AF37]', 'text-black');
                btnMus.classList.replace('text-black', 'text-[#D4AF37]');
                
                heroSub.textContent = "Chronological Order";
                heroTitle.textContent = "REVELATION";
                heroDesc.textContent = "A journey through the timeline of divine command.";
            }

            renderTimeline(mode);
            lenis.scrollTo(0);
        }

        function renderTimeline(mode) {
            const container = document.getElementById('surah-timeline');
            container.innerHTML = '';

            ScrollTrigger.getAll().forEach(t => t.kill());

            let sortedSurahs;
            if (mode === 'revelation') {
                sortedSurahs = revelationOrder.map(num => surahsDB.find(s => s.no === num)).filter(Boolean);
            } else {
                sortedSurahs = [...surahsDB].sort((a, b) => a.no - b.no);
            }

            sortedSurahs.forEach((surah, index) => {
                const isLeft = index % 2 === 0;
                const marginClass = isLeft ? 'md:mr-12' : 'md:ml-12';
                const alignClass = isLeft ? 'md:text-right' : 'md:text-left';
                const flexAlign = isLeft ? 'md:items-end' : 'md:items-start';
                
                const wrapper = document.createElement('div');
                wrapper.className = `relative flex w-full items-center mb-8 ${isLeft ? 'md:justify-end' : 'md:justify-start'} surah-card`;
                
                const node = `
                    <div class="timeline-node hidden md:block"></div>
                    <div class="absolute left-[20px] top-8 w-3 h-3 bg-[#D4AF37] rounded-full md:hidden z-10 shadow-glow"></div>
                `;

                wrapper.innerHTML = `
                    ${node}
                    <div class="w-full md:w-[45%] pl-12 md:pl-0 ${marginClass} opacity-0 transform translate-y-8 transition-all duration-500 group">
                        <div class="card-glass p-6 md:p-8 rounded-2xl hover:border-[#D4AF37]/30 hover:shadow-[0_0_30px_rgba(212,175,55,0.1)] flex flex-col ${flexAlign}">
                            <div class="flex items-center gap-4 mb-4 w-full ${isLeft ? 'md:flex-row-reverse' : 'md:flex-row'} justify-between md:justify-start">
                                <div class="w-10 h-10 rounded-full border border-[#D4AF37]/20 flex items-center justify-center font-serif-display text-[#D4AF37] text-sm group-hover:bg-[#D4AF37] group-hover:text-black transition-colors duration-500">
                                    ${surah.no}
                                </div>
                                <span class="text-[10px] uppercase tracking-widest text-gray-500">${mode === 'revelation' ? 'Rev #' + (index+1) : 'Mushaf #' + surah.no}</span>
                                <div class="font-arabic text-2xl text-gray-600 group-hover:text-[#D4AF37] transition-colors duration-500 ml-auto md:ml-0">€ù</div>
                            </div>
                            <h3 class="text-2xl font-serif-display text-white mb-1 group-hover:translate-x-1 transition-transform duration-300 ${alignClass}">${surah.name}</h3>
                            <p class="text-[#D4AF37] text-xs uppercase tracking-widest mb-4 opacity-80 ${alignClass}">${surah.meaning}</p>
                            <p class="text-gray-400 font-light leading-relaxed text-sm border-t border-white/5 pt-4 group-hover:text-gray-200 transition-colors duration-300 ${alignClass}">
                                ${surah.summary}
                            </p>
                        </div>
                    </div>
                `;
                container.appendChild(wrapper);
            });

            requestAnimationFrame(() => initAnimations());
        }

        function initAnimations() {
            gsap.registerPlugin(ScrollTrigger);
            ScrollTrigger.refresh();

            gsap.to("#hero-content", {
                scrollTrigger: {
                    trigger: "header",
                    start: "top top",
                    end: "bottom top",
                    scrub: true
                },
                y: 150,
                opacity: 0
            });

            const items = document.querySelectorAll('.surah-card > div');
            items.forEach((item, i) => {
                const isLeft = i % 2 === 0;
                const xOffset = window.innerWidth > 768 ? (isLeft ? -50 : 50) : 0;

                gsap.fromTo(item, 
                    { opacity: 0, y: 50, x: xOffset },
                    {
                        opacity: 1,
                        y: 0,
                        x: 0,
                        duration: 1,
                        ease: "power3.out",
                        scrollTrigger: {
                            trigger: item.parentElement,
                            start: "top 85%",
                            end: "top 50%",
                            toggleActions: "play none none reverse"
                        }
                    }
                );
            });
            
            const nodes = document.querySelectorAll('.timeline-node');
            nodes.forEach(node => {
                gsap.fromTo(node,
                    { scale: 0, backgroundColor: "#050507" },
                    {
                        scale: 1,
                        backgroundColor: "#D4AF37",
                        duration: 0.5,
                        scrollTrigger: {
                            trigger: node,
                            start: "top 60%",
                            toggleActions: "play none none reverse"
                        }
                    }
                );
            });
        }

        function generateOGImage() {
            const canvas = document.getElementById('ogCanvas');
            const ctx = canvas.getContext('2d');

            const gradient = ctx.createLinearGradient(0, 0, 0, 630);
            gradient.addColorStop(0, '#050507');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1200, 630);

            ctx.beginPath();
            ctx.strokeStyle = '#D4AF37';
            ctx.lineWidth = 4;
            ctx.moveTo(600, 100);
            ctx.lineTo(600, 530);
            ctx.stroke();

            for(let i=0; i<5; i++) {
                ctx.beginPath();
                ctx.fillStyle = '#D4AF37';
                ctx.arc(600, 150 + (i * 80), 10, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.textAlign = 'center';
            ctx.font = 'bold 80px Cinzel';
            ctx.fillStyle = '#FFFFFF';
            ctx.fillText(currentMode === 'revelation' ? 'REVELATION' : 'AL-QURAN', 600, 300);
            
            ctx.font = '40px Inter';
            ctx.fillStyle = '#D4AF37';
            ctx.fillText('INTERACTIVE TIMELINE', 600, 380);

            const link = document.createElement('a');
            link.download = 'quran-timeline-cover.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>
</html>
